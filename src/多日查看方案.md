# 多日查看 — 方案说明

## 一、目标

- **当前**：选一个日期 → 看该日 9～24 点、9 个指标的**单日变化**。
- **多日**：选多个日期 → 看**同一指标在不同日期的对比**（例如 1/28 和 1/29 的「小贝壳-搜索访客数」两条线一起看）。

---

## 二、数据层（几乎不用改）

- 解析结果已经是「按日期分桶」：`byDate[date].series`、`byDate[date].actions`。
- 多日时只需：根据「选中的多个日期」从 `byDate` 里取出对应日期的 **同一指标**（同一 category+subCategory）的 `values`，拼成「多条线」的数据即可。
- **动作记录**：多日时 tooltip 需要区分「哪一天」的动作，数据上用 `actionsByDate[date][hour]` 即可（现有结构已支持）。

---

## 三、展示逻辑（推荐）

### 3.1 主方案：同一指标、多日对比（推荐）

- **横轴**：仍然是 **9 点～24 点**（不变）。
- **纵轴**：仍是该指标的数值（或 %），**多日共用同一 Y 轴**：取所有选中日期的该指标 min～max，再留边，保证两条/多条线都在同一尺度下可比。
- **每条线**：代表「某一天」的 9～24 点走势；**多条线 = 多天**。
- **图例**：在图上或图旁标出「2026-01-28」「2026-01-29」等，并用不同颜色区分（或一根实线一根虚线）。
- **9 个格子**：仍然是 9 个指标（小贝壳 5 + 销量 4），每个格子里是「该指标的多日对比」，而不是「一天里 9 个指标」。

这样：
- 单日：每个格子 1 条线（和现在一致）。
- 多日：每个格子 N 条线（N = 选中日期数），便于看「同指标、不同天」的差异。

### 3.2 备选：连续时间轴（可后续做）

- 横轴变成「日期+时间」连续：1/28 9点…1/28 24点、1/29 9点…1/29 24点。
- 每个格子 1 条长线，跨多天。
- 实现和交互都更复杂（刻度、tooltip 要带日期+钟点、动作要按 date+hour 查），建议先做 3.1，有需要再加。

---

## 四、UI 交互

### 4.1 模式切换

- 顶栏增加 **「单日 / 多日」** 切换（例如两个 tab、或一个下拉选「单日」「多日」）。
- **单日**：保持现有「日期」下拉，只选一个日期；行为与现在完全一致。
- **多日**：出现「多日选择」控件（见下），选多个日期后，9 个图每个都变成「该指标的多日对比」。

### 4.2 多日时如何选日期

- **方案 A（推荐）**：**日期多选**  
  - 下拉或弹出层中列出所有解析出的日期，每个日期前有 **复选框**。  
  - 用户勾选若干天（如 2026-01-28、2026-01-29）→ 确认后，图表按「选中的日期列表」画多条线。  
  - 优点：任意几天都可对比，灵活。
- **方案 B**：**日期范围**  
  - 选「开始日期」+「结束日期」，中间所有日期都参与（例如 1/28～1/29 就 2 天）。  
  - 优点：交互简单；缺点：不能「只选 1/28 和 1/30」这种不连续的。

建议先做 **方案 A**；若你更希望「选区间」再加方案 B。

### 4.3 与现有能力的衔接

- **更换数据**：不变，仍用顶栏「更换数据」回到上传。
- **日期选择器**：单日时保留现有下拉；多日时改为/增加「多选日期」的控件（见上）。
- **放大态**：点击某个格子放大后，仍然是「该指标」的图，只是单日时 1 条线、多日时 N 条线；左右箭头仍在 9 张图之间切换，逻辑不变。
- **Tooltip**：见下。

---

## 五、Tooltip（多日时）

- 悬停到**某条线的某个点**时，需要明确是「哪一天」。
- **建议**：  
  - 第一行：**日期**（如 2026-01-28）+ **钟点**（如 14 点）。  
  - 第二行：该时刻的**数值**（或 %）。  
  - 若有动作：展示 **该日期、该钟点** 的 `actions[hour]`（多行，一行一个动作，可继续带「分类-动作」格式）。
- 这样「多日 + 动作」的关系仍然清晰：看的是「某天某时刻的数和动作」。

---

## 六、技术实现要点（供开发用）

1. **状态**  
   - 增加 `viewMode: 'single' | 'multi'`。  
   - 单日：`selectedDate: string`（一个）。  
   - 多日：`selectedDates: string[]`（多个，且至少 1 个）。

2. **传给图表的数据**  
   - 单日：和现在一样，`seriesItem`（一个）+ `actions`（该日）。  
   - 多日：每个格子传 `seriesItems: Array<{ date, values, isRate, category, subCategory }>`（同指标、多天）+ `actionsByDate: Record<date, actions>`。  
   - ChartCell 内：若 `seriesItems.length === 1` 就画 1 条线；若 >1 就画多条 Line，每条一个颜色/name=date，并显示 Legend。

3. **Y 轴 domain**  
   - 多日时对该指标：收集所有 `seriesItems[].values` 中的非空值，算全局 min、max，再按现有规则留边（率类 0～max 留边，非率类 min～max 留边）。

4. **颜色**  
   - 多条线用固定色列（如 2～3 种区分度高的颜色循环），或按日期顺序从色板取，保证可区分即可。

5. **图例**  
   - Recharts 的 `Legend`，或自己在图上方/右侧写「日期 → 颜色」的图例；点击图例可考虑支持「显隐某条线」（可选）。

---

## 七、小结

| 项目       | 建议 |
|------------|------|
| 展示含义   | 同一指标、多日对比；横轴仍是 9～24 点，每条线一天。 |
| 选日方式   | 顶栏「单日/多日」切换；多日时用日期多选（复选框列表）。 |
| 数据与 Y 轴 | 沿用现有 byDate；多日时按多天数据算统一 Y 轴。 |
| Tooltip    | 多日时展示「日期 + 钟点 + 数值 + 该日该点动作」。 |
| 放大/切换  | 与现有一致，只是放大后图内可能是多条线。 |

如果你认可「同一指标多日对比 + 日期多选」这一套，我可以按这个方案从顶栏模式切换、多选日期 UI、到 ChartCell 多线 + Tooltip 一步步实现；若有想改的地方（例如坚持用日期范围而不是多选），可以说一下再定实现细节。
