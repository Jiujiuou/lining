# 小贝壳作战 · 数据看板 — 开发计划

## 一、功能概述

- **上传 Excel**：支持在当前网站上传/拖拽 Excel 表格（格式参考 `小贝壳作战.xlsx`），纯前端解析，无需后端。
- **解析表格**：按约定格式解析（日期、大类、小类、9 点～24 点整点数据 + 动作记录）。
- **折线图展示**：根据所选日期渲染 9 个小折线图，3×3 排布；支持点击放大、左右切换查看。
- **动作与数据关联**：悬停折线某时间点时，通过 tooltip 展示该时刻的数值 + 该时刻若有「动作记录」则多行列出，用于观察操作与数据变化的关系。

---

## 二、表格格式约定

- **第 1 列**：日期\时间（按天，同一天多行共用同一日期）。
- **第 2 列**：大类（小贝壳 / 销量 / 动作记录）。
- **第 3 列**：小类（如 搜索访客数、搜索转化、旗舰店、自己 等）。
- **第 4～19 列**：9 点～24 点共 16 个整点，每格为数值或动作文字。
- **动作记录**：仅用于 tooltip，不参与画折线；同一时刻可能有多行动作（自己/旗舰店/数码等），tooltip 中多行展示，一个动作一行。

---

## 三、折线图拆分与布局

- **大类**：只对「小贝壳」「销量」两类画折线；「动作记录」不画线，只用于 tooltip。
- **小类数量**：小贝壳约 4～5 个，销量约 4 个，共 **9 个折线图**，每图 **1 条折线**。
- **排布**：画面中心 **3×3 网格**，按大类顺序：先小贝壳（5 个），再销量（4 个），从左到右、从上到下填满 9 格。
- **交互**：
  - 点击某一格 → 进入放大态：背景半透明灰，当前图居中放大显示。
  - 左右箭头（使用 **react-icons**，已安装）→ 在 9 张图之间顺序切换，可循环（第 9 张下一张为第 1 张，第 1 张上一张为第 9 张）。
  - 点击背景或 ESC → 关闭放大，回到 3×3 网格。

---

## 四、顶部与日期

- **顶部**：左侧为标题（如「小贝壳作战 · 数据看板」），**右上角**为日期选择器。
- **日期选择**：选择日期后，仅渲染该日 9～24 点的数据；若有多个日期，从解析结果中取可选日期列表供选择。
- **放大态**：日期选择器仍可见，切换日期后刷新中间 9 张图；在放大态下也可左右切换查看其他图。

---

## 五、数据与纵轴规则

### 5.1 数值解析

- **"100+"**：只取数字部分，按 100 参与计算与绘图。
- **"-"**：视为无数据，该时间点不绘制（折线在此处断线）。
- **空单元格**：视为无数据，不绘制该点（断线）。例如 8 点有值、9 点空、10 点有值 → 只画 8 点到 10 点的线段。
- **空 ≠ 0**：不把空或 "-" 当 0 画点。

### 5.2 率类指标（纵轴与表头）

- **率类**：当前约定为「搜索转化」「购物车转化」。
- **表头/图标题**：率类在展示时带 **%**（如「小贝壳 - 搜索转化 %」）。
- **纵轴**：率类用 **0～max(该图数据) 留边**（如 max×1.1），纵轴刻度可按百分比显示。

### 5.3 纵轴动态计算（不强制从 0 开始）

- **原则**：纵坐标根据每个图自己的数据 **动态计算**，不强制从 0 开始，以保证折线起伏清晰。
- **率类**：domain 建议 `[0, max(数据) × 1.1]`，纵轴显示为 %。
- **非率类**（访客数、加购件数、销量等）：domain 建议 **min～max 留边**，例如 `[dataMin - 5% 跨度, dataMax + 5% 跨度]` 或 `[dataMin - 小常数, dataMax + 小常数]`，突出变化。
- **边界**：某图全空或全断线时给默认小范围（如 0～10）；所有值相同时在该值上下留边，避免贴轴。

---

## 六、Tooltip

- **触发**：鼠标悬停在折线某时间点（如 14 点）时显示。
- **内容**：
  - 该时间点的数值（当前折线对应的 大类-小类 在该时刻的值）。
  - 该时刻若有「动作记录」，则在该 tooltip 中列出：**多个动作时分行展示，一个动作一行**。
- **动作来源**：解析时按时间点聚合所有「动作记录」行在该列的非空文案。

---

## 七、技术选型

- **解析**：纯前端解析 Excel（如 SheetJS / xlsx 或 exceljs，选其一在浏览器中解析）。
- **图表**：**Recharts**（与 React 搭配自然，折线图 + 自定义 Tooltip 易实现，满足当前复杂度）。
- **图标**：**react-icons**（已安装），用于放大态左右切换箭头等。
- **框架**：当前项目为 React + Vite，在上述基础上实现即可。

---

## 八、页面结构小结

| 区域     | 内容 |
|----------|------|
| 顶栏     | 标题 + 右上角日期选择器 |
| 主体     | 3×3 小折线图网格，按大类顺序（小贝壳 5 + 销量 4） |
| 每格     | 标题「大类 - 小类」（率类带 %）；横轴 9～24 点；纵轴按数据 min～max 留边；点击进入放大态 |
| 放大态   | 半透明灰底 + 居中大图 + 左/右箭头（react-icons）循环切换 9 张；点击背景或 ESC 关闭 |
| 底部     | 上传/拖拽 Excel 区域 |
| Tooltip  | 悬停折线点 → 该点数值 + 该时刻动作记录（多行，一行一个动作） |

---

## 九、待实现模块（建议）

1. **Excel 解析**：读入文件 → 按行列解析出日期、大类、小类、各整点数值与动作记录；输出结构化数据（按日期、按 大类-小类、按时间点聚合动作）。
2. **数据层**：存储解析结果、当前选中日期、可选日期列表；为 9 张图分别计算 min/max 与 domain。
3. **图表组件**：单张折线图（Recharts），接收单条序列 + 该日动作记录按时间点聚合结果；支持自定义 Tooltip（数值 + 多行动作）。
4. **3×3 网格页**：根据当前日期渲染 9 个图表格，点击格设当前放大索引并进入放大态。
5. **放大态**：蒙层 + 居中大图 + 左/右箭头（react-icons）切换索引（0～8 循环）。
6. **顶栏**：标题 + 日期选择器（选项来自解析出的日期列表）。
7. **上传区**：文件选择或拖拽 → 触发解析 → 更新数据与日期列表，默认选第一个日期。

以上为当前沟通对齐后的开发计划，可作为实现与评审依据。
