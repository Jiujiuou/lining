# 单日 / 多日对比 — 切换与布局（ASCII）

支持三种方式：**单日**、**多日连续（主日期 + 前 N 天）**、**多日不连续（自选任意几天）**。

---

## 一、顶栏布局总览

```
+------------------------------------------------------------------------------------------------------------------------+
|  小贝壳作战 · 数据看板                                                                                                  |
|                                                                                                                        |
|   [ 单日 ]  [ 多日连续 ]  [ 多日自选 ]       （根据模式显示不同控件）                              [ 更换数据 ]          |
+------------------------------------------------------------------------------------------------------------------------+
```

---

## 二、模式一：单日

```
顶栏:   [ 单日 ]  [ 多日连续 ]  [ 多日自选 ]     日期 [ 2026-01-29 ▼ ]      [ 更换数据 ]
              ^ 选中                                    ^
                                                     选 1 天

逻辑:   selectedDates = [ selectedDate ]  →  每格 1 条线

主体:   3×3，每格 1 条线（该日 9～24 点）
       +----------+  +----------+  +----------+
       | 小贝壳   |  | 小贝壳   |  | 小贝壳   |
       |   \_/    |  |  _       |  |   /\_    |
       | 9..24点  |  | 9..24点  |  | 9..24点  |
       +----------+  +----------+  +----------+
```

---

## 三、模式二：多日连续（主日期 + 前 N 天，共 N 天）

适用于：「当前与前两天共 3 天」「最近 7 天」等。

```
顶栏:   [ 单日 ]  [ 多日连续 ]  [ 多日自选 ]     日期 [ 2026-01-29 ▼ ]   共 [ 3 ▼ ] 天      [ 更换数据 ]
                              ^ 选中                  ^ 主日期           ^ 天数
                                                                     (2/3/5/7 等)

逻辑:   主日期 = 2026-01-29，共 3 天
       → 在 parsedData.dates 里取「主日期及往前 2 天」：
         dates 已排序，找到 2026-01-29 的索引 i，取 [ dates[i-2], dates[i-1], dates[i] ]
       → selectedDates = [ "2026-01-27", "2026-01-28", "2026-01-29" ]
       → 每格 3 条线

主体:   3×3，每格 3 条线（图例区分日期）
       +----------+  +----------+  +----------+
       | 小贝壳   |  | 小贝壳   |  | 小贝壳   |
       | \ 1/29  |  |  1/29    |  | / 1/29   |
       |  \ 1/28 |  |  \ 1/28  |  |/  1/28   |
       |   \1/27 |  |    \1/27  |  |   1/27   |
       | 9..24点  |  | 9..24点  |  | 9..24点  |
       +----------+  +----------+  +----------+
       图例: ● 2026-01-29  ● 2026-01-28  ● 2026-01-27
```

- **共 7 天**：选「共 7 天」即主日期 + 往前 6 天，共 7 条线。
- 若解析出的日期不足 N 天（例如只有 2 天）：只取有的那些天，画 2 条线。

---

## 四、模式三：多日不连续（自选任意几天）

适用于：「不连续的 7 天」「随便挑几天对比」。

```
顶栏:   [ 单日 ]  [ 多日连续 ]  [ 多日自选 ]     [ 选日期 (已选 3 天) ▼ ]      [ 更换数据 ]
                                          ^ 选中            ^ 点击展开多选

展开后:
       +------------------------------------------+
       |  选日期（可多选，不要求连续）               |
       |  ☑ 2026-01-27                             |
       |  ☐ 2026-01-28                             |
       |  ☑ 2026-01-29                             |
       |  ☑ 2026-01-30                             |
       |  ...（解析出的所有日期）                    |
       +------------------------------------------+

逻辑:   selectedDates = 用户勾选的日期列表（保持选择顺序或按日期排序）
       → 每格 N 条线，N = selectedDates.length

主体:   3×3，每格 N 条线（图例按选中日期区分）
       +----------+  +----------+  +----------+
       | 小贝壳   |  | 小贝壳   |  | 小贝壳   |
       | 多条线   |  | 多条线   |  | 多条线   |
       | 1/27     |  | 1/29     |  | 1/30     |
       | 1/29     |  | 1/30     |  | ...      |
       | 1/30     |  | ...      |  | 9..24点  |
       | 9..24点  |  | 9..24点  |  |          |
       +----------+  +----------+  +----------+
       图例: ● 2026-01-27  ● 2026-01-29  ● 2026-01-30
```

- 不要求连续：可以只选 1/27、1/29、1/30 这 3 天，共 3 条线。
- 可以选 7 个不连续的日期，每格 7 条线。

---

## 五、三种模式对比（ASCII）

```
+-------------+------------------+----------------------+----------------------+
| 模式        | 顶栏控件         | 得到 selectedDates   | 每格线数             |
+-------------+------------------+----------------------+----------------------+
| 单日        | 日期 [ 下拉 ]    | [ 选中的 1 天 ]      | 1                    |
+-------------+------------------+----------------------+----------------------+
| 多日连续    | 日期 [ 下拉 ]    | 主日期及往前 (N-1) 天 | N（2/3/5/7 等）      |
|             | 共 [ N 天 下拉 ] | 在 dates 中连续取    |                      |
+-------------+------------------+----------------------+----------------------+
| 多日自选    | [ 选日期 多选 ]  | 用户勾选的任意几天   | 勾选几天就几条       |
|             | 复选框列表       | 可不连续            |                      |
+-------------+------------------+----------------------+----------------------+
```

---

## 六、状态与数据流（统一）

```
                    +------------------+
                    |   parsedData     |
                    | dates[], byDate  |
                    +--------+---------+
                             |
         +-------------------+-------------------+-------------------+
         |                   |                   |                   |
         v                   v                   v                   v
  viewMode ===         viewMode ===         viewMode ===
  'single'             'multiRange'         'multiPick'
  (单日)                (多日连续)           (多日自选)
         |                   |                   |
         v                   v                   v
  selectedDate         selectedDate         selectedDates
  → [ date ]           + rangeDays (N)       = 用户勾选列表
                       → dates 中连续取 N 天   （可不连续）
         |                   |                   |
         +-------------------+-------------------+-------------------+
                             |
                             v
                    selectedDates: string[]   （1 条或多条）
                             |
                             v
                    每格: seriesItems = selectedDates.map(d => byDate[d] 中该指标)
                         actionsByDate = { [d]: byDate[d].actions }
                             |
                             v
                    ChartCell( seriesItems, actionsByDate )
                    → 画 seriesItems.length 条 Line + 图例
```

---

## 七、实现要点速览

| 项目 | 说明 |
|------|------|
| 顶栏模式 | 三个入口：单日、多日连续、多日自选；当前模式高亮，下方/右侧展示对应控件。 |
| 状态 | `viewMode: 'single' \| 'multiRange' \| 'multiPick'`；`selectedDate`（单日/连续的主日期）；`rangeDays`（连续 N 天，如 3/7）；`selectedDates`（最终参与对比的日期列表，由当前模式计算或用户勾选）。 |
| 连续 N 天 | 在 `parsedData.dates` 中找 `selectedDate` 的索引 i，取 `dates.slice(Math.max(0, i - N + 1), i + 1)`，保证「主日期及往前」共最多 N 天。 |
| 不连续多选 | 弹层/下拉内展示所有 `parsedData.dates`，每行复选框；选中的日期组成 `selectedDates`，顺序可按日期排。 |
| ChartCell | 统一传 `seriesItems: Array<{ date, values, isRate, category, subCategory }>` 和 `actionsByDate`；单日即 `seriesItems.length === 1`。 |
| 图例与颜色 | 多条线用固定色列循环，图例项为日期；线多时可考虑图例可点击显隐（可选）。 |

这样既支持「当前与前两天共 3 天」「最近 7 天」的连续对比，也支持「不连续的 7 天」或任意自选几天对比。
